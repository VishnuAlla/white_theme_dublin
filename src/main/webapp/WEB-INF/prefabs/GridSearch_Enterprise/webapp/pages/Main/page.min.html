<style id="Main.css">
.text-style{
    border-style: solid;
    border-width: 1px;
    border-color: #c8c8c8;
    height:40px;
}
</style>
<script id="Main.js">
Application.$controller("GridSearchController", ["$scope", function($scope) {
    "use strict";

    /* 
     * This function will be invoked when any of this prefab's property is changed
     * @key: property name
     * @newVal: new value of the property
     * @oldVal: old value of the property
     removed by saurabh (debugger)
     */
    function propertyChangeHandler(key, newVal, oldVal) {


            switch (key) {
                case "griddata":
                    if ($scope.isGridSearchApplied) {
                        $scope.isGridSearchApplied = false;
                    } else {
                        //The grid data is refreshed with real data.
                        $scope.gridDataForSearch = newVal;
                        //Remove/clear text from search text widget.
                        $scope.clearSearchText();
                    }
                    break;
                case "gridsearchtext":
                    break;
            }

        }
        /* register the property change handler */
    $scope.propertyManager.add($scope.propertyManager.ACTIONS.CHANGE, propertyChangeHandler);

    $scope.onInitPrefab = function() {
        // this method will be triggered post initialization of the prefab.
    }

    $scope.isGridSearchApplied = false;
    $scope.gridDataForSearch = [];




    $scope.searchbtnClick = function($event, $isolateScope) {


        var gridSearchText = $scope.Widgets.gridsearchtext.datavalue.toLowerCase();
        var gridName = $isolateScope.$parent.girdname;
        var gridScope = $scope.$parent.$parent;
        var gridWidget = gridScope.Widgets[gridName];

        if (gridName === undefined || gridWidget === undefined) {
            console.log("Error: The property 'gridname' is not given or it's not defined.");
            return;
        }
        var filteredData = jQuery.grep($scope.gridDataForSearch, function(rowData, rowDataIndex) {

            var isGridSearchTextFound = false;
            //console.log(rowData);
            //Do grid search only on the column configured to display.
            $.each(gridWidget.columns, function(columnIndex, column) {
                //console.log(column);
                //It number convert into string to do string comparision.
                var columnValue = rowData[column.field] + "";
                if (columnValue !== undefined && columnValue.toLowerCase().indexOf(gridSearchText) >= 0) {
                    isGridSearchTextFound = true;
                    return false; //It breaks the for each loop.
                }
            });
            return isGridSearchTextFound;
        });

        $scope.isGridSearchApplied = true;
        gridScope.Variables[gridWidget.variableName].dataSet = filteredData;
    };


    $scope.clearSearchText = function() {
        $scope.Widgets.gridsearchtext.datavalue = "";
    };



    $scope.gridsearchtextKeyup = function($event, $isolateScope) {
        if ($event.which === 13) {

            console.log($event);
            console.log($isolateScope);
            $scope.searchbtnClick($event, $isolateScope);
        }
    };




}]);
</script>
<script id="Main.variables.json">
var _MainPage_Variables_ ={
  "supportedLocale" : {
    "_id" : "wm-wm.Variable1402640443182",
    "name" : "supportedLocale",
    "owner" : "Page",
    "category" : "wm.Variable",
    "dataSet" : {
      "en" : "English"
    },
    "type" : "string",
    "isList" : false,
    "saveInPhonegap" : false
  }
}
</script>
<script id="Main.html" type="text/ng-template">
<wm-page data-ng-controller="GridSearchController" name="page1">
    <wm-container name="Container1" backgroundcolor="#ffffff" padding="0px">
        <wm-layoutgrid name="layoutgrid1">
            <wm-gridrow name="gridrow1">
                <wm-gridcolumn columnwidth="12" name="gridcolumn1">
                    <wm-text name="gridsearchtext" class="pull-left" height="40" width="400" on-keyup="gridsearchtextKeyup($event, $scope)" on-change="gridsearchtextChange($event, $scope)" placeholder="Search"></wm-text>
                    <wm-button class="btn-default pull-left" caption="" type="button" name="searchbtn" iconclass="wi wi-search fa-lg" on-click="searchbtnClick($event, $scope)" height="40" width="60"></wm-button>
                </wm-gridcolumn>
            </wm-gridrow>
        </wm-layoutgrid>
    </wm-container>
</wm-page>
</script>